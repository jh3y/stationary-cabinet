*
*:after
*:before
  box-sizing border-box
  transform-style preserve-3d
  transition all 0.2s

@property --x
  syntax '<length-percentage>'
  inherits false
  initial-value 0%

@property --sx
  syntax '<length-percentage>'
  inherits false
  initial-value 0%

@property --sz
  syntax '<length>'
  inherits false
  initial-value 0
  
@property --z
  syntax '<length>'
  inherits true
  initial-value 0

@property --r
  syntax '<angle>'
  inherits false
  initial-value 0deg

@property --rs
  syntax '<angle>'
  inherits false
  initial-value 0deg

@property --flip
  syntax '<angle>'
  inherits false
  initial-value 0deg
  
@property --opacity
  syntax '<number>'
  inherits false
  initial-value 0
  
@property --speed
  syntax '<time>'
  inherits true
  initial-value 1.5s

:root
  --spin-speed 0
  --border-width 1.8vmin
  --depth 20vmin
  --stack-height 3vmin
  --scene-size 16vmin
  --ring-size calc(var(--scene-size) * 0.6)
  --plane radial-gradient(hsla(0, 0%, 0%, 0.1) 50%, transparent 65%)
  --ring-shadow hsla(0, 0%, 0%, 0.5)
  --hue-one 320
  --hue-two 210
  --blur 10px
  --bg hsl(0, 0%, 98%)
  --ring-filter brightness(1) drop-shadow(0 0 0 var(--accent))
  
  @media(prefers-color-scheme dark)
    --bg hsl(0, 0%, 15%)
    --ring-shadow 'hsla(%s, 100%, 50%, 1)' % var(--hue-one)
    --plane 'radial-gradient(hsla(%s, 90%, 60%, 0.1) 50%, transparent 65%)' % var(--hue-one)
    --ring-filter brightness(1.75) drop-shadow(0 0 1vmin var(--accent))

body
  background var(--bg)
  min-height 100vh
  display grid
  place-items center
  overflow hidden
  
.scene
  height var(--scene-size)
  width var(--scene-size)
  transform translate(calc(var(--flip-flop, 1) * -50%), 0) translate3d(var(--sx), 0, var(--sz))
  animation step-down var(--speed) infinite linear
  
  &__shadow
    position absolute
    top 0
    left 100%
    height 100%
    width 100%
    opacity var(--opacity)
    animation fade-in var(--speed) infinite linear
    background var(--plane)
    transform scale(1.25)
    filter blur(var(--blur))

.flipper
  height var(--scene-size)
  width var(--scene-size)
  transform rotate(var(--flip))
  animation flip-flop calc(var(--speed) * 2) infinite steps(1)

.plane
  height 100%
  width 100%
  transform translate3d(0, 0, var(--depth))
  position relative
  
  &__shadow
    content ''
    height 100%
    width 100%
    position absolute
    top 50%
    left 50%
    background var(--plane)
    filter blur(var(--blur))
    transform translate(-50%, -50%) scale(1.25)
    opacity var(--opacity)
    animation fade-out var(--speed) infinite linear  

.scene__shadow
.plane__shadow    
  &:after
    content ''
    height var(--ring-size)
    width var(--ring-size)
    position absolute
    top 50%
    left 50%
    border var(--border-width) solid var(--ring-shadow)
    border-radius 50%
    transform translate(-50%, -50%) scale(0.75)
      
.container
  transform translate3d(0, 0, 100vmin) rotateX(-12deg) rotateY(0deg) rotateX(90deg) translate3d(0, 0, calc(var(--depth) * -1.5)) rotate(var(--rs))
  animation rotate-scene calc(var(--speed) * var(--spin-speed)) infinite linear
  
.ring
  --origin-z calc(var(--stack-height) - (var(--stack-height) / var(--ring-count)) * var(--index))
  --hue var(--hue-one)
  --accent 'hsl(%s 100% 55%)' % var(--hue)
  --ring-filter brightness(1) drop-shadow(0 0 0 var(--accent))
  height var(--ring-size)
  width var(--ring-size)
  border-radius 50%
  border var(--border-width) solid var(--accent)
  position absolute
  top 50%
  left 50%
  transform translate3d(-50%, -50%, var(--origin-z)) translate3d(var(--x), 0, var(--z)) rotateY(var(--r))
  transform-origin calc(100% + (var(--scene-size) * 0.2)) 50%
  animation-name var(--name)
  animation-duration var(--speed)
  animation-iteration-count infinite
  animation-timing-function cubic-bezier(.25,0,1,1)
  filter var(--ring-filter)
  
  &:nth-of-type(odd)
    --hue var(--hue-two)
    
  @media(prefers-color-scheme dark)
    --ring-filter brightness(2) drop-shadow(0 0 calc(var(--border-width) * 0.5) var(--accent))